name: CD Pipeline

on:
    push:
        branches: [ main, stage, devel ]

jobs:
    deploy:
        runs-on: ubuntu-latest
    
    env:
        AWS-REGION: us-east-2
        BUCKET_NAME: ${{ (github.ref == 'refs/heads/main' && 'rdicidr-app-prod') || (github.ref == 'refs/heads/stage' && 'rdicidr-app-stage') || (github.ref == 'refs/heads/devel' && 'rdicidr-app-devel') }}
        DISTRIBUTION_ID: ${{ (github.ref == 'refs/heads/main' && secrets.PROD_DISTRIBUTION_ID) || (github.ref == 'refs/heads/stage' && secrets.STAGE_DISTRIBUTION_ID) || (github.ref == 'refs/heads/devel' && secrets.DEVEL_DISTRIBUTION_ID) }}
    
    permisions:
        id-token: write
        content: read
    
    steps:
        - name: Check out code
          uses: actions/checkout@v2

        - name: Set up Node.js
          uses: actions/setup-node@v2
          with:
            node-version: '15'

        - name: Install dependencies
          run: npm ci
          
        - name: Build project
           run: npm run build

    
